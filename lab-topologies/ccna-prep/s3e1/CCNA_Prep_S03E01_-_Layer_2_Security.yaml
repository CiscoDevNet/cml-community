annotations:
  - border_color: '#00000000'
    border_style: ''
    color: '#808080FF'
    rotation: 0
    text_bold: false
    text_content: |-
      Secure MAC Addresses:
      Static - manual
      Dynamic - automatic
      Sticky - automatic and stored

      Port Security Violation Types:
      Protect - drops quietly
      Restrict - drops, logs, traps, increments
      Shutdown - drops, err-disabled, logs, traps, increments
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -1280.0
    y1: -320.0
    z_index: 1
  - border_color: '#00000000'
    border_style: ''
    color: '#808080FF'
    rotation: 0
    text_bold: false
    text_content: |-
      Static
      Protect
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: 40.0
    y1: -280.0
    z_index: 2
  - border_color: '#00000000'
    border_style: ''
    color: '#808080FF'
    rotation: 0
    text_bold: false
    text_content: |-
      Restrict
      Dynamic
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: 40.0
    y1: -200.0
    z_index: 3
  - border_color: '#00000000'
    border_style: ''
    color: '#808080FF'
    rotation: 0
    text_bold: false
    text_content: |-
      Shutdown
      Sticky
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: 40.0
    y1: -120.0
    z_index: 4
  - border_color: '#00000000'
    border_style: ''
    color: '#808080FF'
    rotation: 0
    text_bold: false
    text_content: 5.7 Configure and verify Layer 2 security features (DHCP snooping,
      dynamic ARP inspection, and port security)
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -1200.0
    y1: -400.0
    z_index: 5
  - border_color: '#00000000'
    border_style: ''
    color: '#FEF9F9'
    rotation: 0
    text_bold: false
    text_content: Securing the Switch with Essential Layer 2 Protections
    text_font: monospace
    text_italic: false
    text_size: 16
    text_unit: pt
    thickness: 1
    type: text
    x1: -1200.0
    y1: -440.0
    z_index: 7
smart_annotations:
  - tag: VLAN10
    is_on: true
    padding: 100
    label: VLAN 10
    tag_offset_x: 0
    tag_offset_y: -115
    tag_size: 18
    group_distance: 400
    thickness: 1
    border_style: ''
    fill_color: '#C72A2880'
    border_color: '#00000080'
    z_index: -4
nodes:
  - boot_disk_size: null
    configuration:
      - name: node.cfg
        content: |-
          # this is a shell script which will be sourced at boot
          hostname PC1
          # configurable user account
          USERNAME=cisco
          PASSWORD=cisco
          auto eth0
          iface eth0 inet dhcp
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n0
    image_definition: null
    label: PC1
    node_definition: desktop
    parameters: {}
    ram: null
    tags:
      - VLAN10
    x: -80
    y: -280
    interfaces:
      - id: i0
        label: eth0
        mac_address: '52:54:00:11:11:11'
        type: physical
        slot: 0
  - boot_disk_size: null
    configuration:
      - name: node.cfg
        content: |-
          # this is a shell script which will be sourced at boot
          hostname PC2
          # configurable user account
          USERNAME=cisco
          PASSWORD=cisco
          auto eth0
          iface eth0 inet dhcp
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n1
    image_definition: null
    label: PC2
    node_definition: desktop
    parameters: {}
    ram: null
    tags:
      - VLAN10
    x: -80
    y: -200
    interfaces:
      - id: i0
        label: eth0
        mac_address: '52:54:00:22:22:22'
        type: physical
        slot: 0
  - boot_disk_size: null
    configuration:
      - name: node.cfg
        content: |-
          # this is a shell script which will be sourced at boot
          hostname PC3
          # configurable user account
          USERNAME=cisco
          PASSWORD=cisco
          auto eth0
          iface eth0 inet dhcp
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n2
    image_definition: null
    label: PC3
    node_definition: desktop
    parameters: {}
    ram: null
    tags:
      - VLAN10
    x: -80
    y: -120
    interfaces:
      - id: i0
        label: eth0
        mac_address: '52:54:00:33:33:33'
        type: physical
        slot: 0
  - boot_disk_size: null
    configuration: []
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n3
    image_definition: null
    label: Internet
    node_definition: external_connector
    parameters: {}
    ram: null
    tags: []
    x: -729
    y: -200
    interfaces:
      - id: i0
        label: port
        mac_address: null
        type: physical
        slot: 0
  - boot_disk_size: null
    configuration:
      - name: ios_config.txt
        content: |-
          hostname ASW
          !
          vtp domain CCNAPREP
          vtp mode transparent
          !
          no ip domain lookup
          !
          vlan 10
           name CCNAPREP
          !
          interface Gi0/0
           switchport trunk encapsulation dot1q
           switchport mode trunk
           no shut
          !
          interface Gi0/1
           switchport access vlan 10
           switchport mode access
           spanning-tree portfast
           no shut
          !
          interface Gi0/2
           switchport access vlan 10
           switchport mode access
           spanning-tree portfast
           no shut
          !
          interface Gi0/3
           switchport access vlan 10
           switchport mode access
           spanning-tree portfast
           no shut
          !
          interface Gi1/0
           switchport access vlan 10
           switchport mode access
           spanning-tree portfast
           description For Part 5 connection to Rogue DHCP server
           no shut
          !
          line con 0
           exec-timeout 0 0
           privilege level 15
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n4
    image_definition: null
    label: ASW
    node_definition: iosvl2
    parameters: {}
    ram: null
    tags: []
    x: -320
    y: -200
    interfaces:
      - id: i0
        label: Loopback0
        mac_address: null
        type: loopback
      - id: i1
        label: GigabitEthernet0/0
        mac_address: null
        type: physical
        slot: 0
      - id: i2
        label: GigabitEthernet0/1
        mac_address: null
        type: physical
        slot: 1
      - id: i3
        label: GigabitEthernet0/2
        mac_address: null
        type: physical
        slot: 2
      - id: i4
        label: GigabitEthernet0/3
        mac_address: null
        type: physical
        slot: 3
      - id: i5
        label: GigabitEthernet1/0
        mac_address: null
        type: physical
        slot: 4
      - id: i6
        label: GigabitEthernet1/1
        mac_address: null
        type: physical
        slot: 5
      - id: i7
        label: GigabitEthernet1/2
        mac_address: null
        type: physical
        slot: 6
      - id: i8
        label: GigabitEthernet1/3
        mac_address: null
        type: physical
        slot: 7
  - boot_disk_size: null
    configuration:
      - name: ios_config.txt
        content: |-
          hostname DSW
          vtp domain CCNAPREP
          vtp mode transparent
          !
          no ip domain lookup
          !
          vlan 10
           name CCNAPREP
          !
          interface Gi0/0
           switchport trunk encapsulation dot1q
           switchport mode trunk
           no shut
          !
          interface Gi0/1
           switchport mode access
           switchport access vlan 10
           no shut
          !
          line con 0
           exec-timeout 0 0
           privilege level 15
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n5
    image_definition: null
    label: DSW
    node_definition: iosvl2
    parameters: {}
    ram: null
    tags: []
    x: -541
    y: -198
    interfaces:
      - id: i0
        label: Loopback0
        mac_address: null
        type: loopback
      - id: i1
        label: GigabitEthernet0/0
        mac_address: null
        type: physical
        slot: 0
      - id: i2
        label: GigabitEthernet0/1
        mac_address: null
        type: physical
        slot: 1
      - id: i3
        label: GigabitEthernet0/2
        mac_address: null
        type: physical
        slot: 2
      - id: i4
        label: GigabitEthernet0/3
        mac_address: null
        type: physical
        slot: 3
  - boot_disk_size: null
    configuration:
      - name: dnsmasq.conf
        content: |-
          interface=eth0
          dhcp-range=192.168.255.25,192.168.255.50,24h
          dhcp-option=option:router,192.168.255.1
          dhcp-option=option:dns-server,8.8.8.8,8.8.4.4
          #
          #
          # Configuration file for dnsmasq.
          #
          # Format is one option per line, legal options are the same
          # as the long options legal on the command line. See
          # "/usr/sbin/dnsmasq --help" or "man 8 dnsmasq" for details.

          # Listen on this specific port instead of the standard DNS port
          # (53). Setting this to zero completely disables DNS function,
          # leaving only DHCP and/or TFTP.
          #port=5353

          # The following two options make you a better netizen, since they
          # tell dnsmasq to filter out queries which the public DNS cannot
          # answer, and which load the servers (especially the root servers)
          # unnecessarily. If you have a dial-on-demand link they also stop
          # these requests from bringing up the link unnecessarily.

          # Never forward plain names (without a dot or domain part)
          #domain-needed
          # Never forward addresses in the non-routed address spaces.
          #bogus-priv

          # Uncomment these to enable DNSSEC validation and caching:
          # (Requires dnsmasq to be built with DNSSEC option.)
          #conf-file=%%PREFIX%%/share/dnsmasq/trust-anchors.conf
          #dnssec

          # Replies which are not DNSSEC signed may be legitimate, because the domain
          # is unsigned, or may be forgeries. Setting this option tells dnsmasq to
          # check that an unsigned reply is OK, by finding a secure proof that a DS
          # record somewhere between the root and the domain does not exist.
          # The cost of setting this is that even queries in unsigned domains will need
          # one or more extra DNS queries to verify.
          #dnssec-check-unsigned

          # Uncomment this to filter useless windows-originated DNS requests
          # which can trigger dial-on-demand links needlessly.
          # Note that (amongst other things) this blocks all SRV requests,
          # so don't use it if you use eg Kerberos, SIP, XMMP or Google-talk.
          # This option only affects forwarding, SRV records originating for
          # dnsmasq (via srv-host= lines) are not suppressed by it.
          #filterwin2k

          # Change this line if you want dns to get its upstream servers from
          # somewhere other that /etc/resolv.conf
          #resolv-file=

          # By  default,  dnsmasq  will  send queries to any of the upstream
          # servers it knows about and tries to favour servers to are  known
          # to  be  up.  Uncommenting this forces dnsmasq to try each query
          # with  each  server  strictly  in  the  order  they   appear   in
          # /etc/resolv.conf
          #strict-order

          # If you don't want dnsmasq to read /etc/resolv.conf or any other
          # file, getting its servers from this file instead (see below), then
          # uncomment this.
          #no-resolv

          # If you don't want dnsmasq to poll /etc/resolv.conf or other resolv
          # files for changes and re-read them then uncomment this.
          #no-poll

          # Add other name servers here, with domain specs if they are for
          # non-public domains.
          #server=/localnet/192.168.0.1

          # Example of routing PTR queries to nameservers: this will send all
          # address->name queries for 192.168.3/24 to nameserver 10.1.2.3
          #server=/3.168.192.in-addr.arpa/10.1.2.3

          # Add local-only domains here, queries in these domains are answered
          # from /etc/hosts or DHCP only.
          #local=/localnet/

          # Add domains which you want to force to an IP address here.
          # The example below send any host in double-click.net to a local
          # web-server.
          #address=/double-click.net/127.0.0.1

          # --address (and --server) work with IPv6 addresses too.
          #address=/www.thekelleys.org.uk/fe80::20d:60ff:fe36:f83

          # Add the IPs of all queries to yahoo.com, google.com, and their
          # subdomains to the vpn and search ipsets:
          #ipset=/yahoo.com/google.com/vpn,search

          # Add the IPs of all queries to yahoo.com, google.com, and their
          # subdomains to netfilters sets, which is equivalent to
          # 'nft add element ip test vpn { ... }; nft add element ip test search { ... }'
          #nftset=/yahoo.com/google.com/ip#test#vpn,ip#test#search

          # Use netfilters sets for both IPv4 and IPv6:
          # This adds all addresses in *.yahoo.com to vpn4 and vpn6 for IPv4 and IPv6 addresses.
          #nftset=/yahoo.com/4#ip#test#vpn4
          #nftset=/yahoo.com/6#ip#test#vpn6

          # You can control how dnsmasq talks to a server: this forces
          # queries to 10.1.2.3 to be routed via eth1
          # server=10.1.2.3@eth1

          # and this sets the source (ie local) address used to talk to
          # 10.1.2.3 to 192.168.1.1 port 55 (there must be an interface with that
          # IP on the machine, obviously).
          # server=10.1.2.3@192.168.1.1#55

          # If you want dnsmasq to change uid and gid to something other
          # than the default, edit the following lines.
          #user=
          #group=

          # If you want dnsmasq to listen for DHCP and DNS requests only on
          # specified interfaces (and the loopback) give the name of the
          # interface (eg eth0) here.
          # Repeat the line for more than one interface.
          #interface=
          # Or you can specify which interface _not_ to listen on
          #except-interface=
          # Or which to listen on by address (remember to include 127.0.0.1 if
          # you use this.)
          #listen-address=
          # If you want dnsmasq to provide only DNS service on an interface,
          # configure it as shown above, and then use the following line to
          # disable DHCP and TFTP on it.
          #no-dhcp-interface=

          # On systems which support it, dnsmasq binds the wildcard address,
          # even when it is listening on only some interfaces. It then discards
          # requests that it shouldn't reply to. This has the advantage of
          # working even when interfaces come and go and change address. If you
          # want dnsmasq to really bind only the interfaces it is listening on,
          # uncomment this option. About the only time you may need this is when
          # running another nameserver on the same machine.
          #bind-interfaces

          # If you don't want dnsmasq to read /etc/hosts, uncomment the
          # following line.
          #no-hosts
          # or if you want it to read another file, as well as /etc/hosts, use
          # this.
          #addn-hosts=/etc/banner_add_hosts
          addn-hosts=/etc/banner_add_hosts

          # Set this (and domain: see below) if you want to have a domain
          # automatically added to simple names in a hosts-file.
          #expand-hosts

          # Set the domain for dnsmasq. this is optional, but if it is set, it
          # does the following things.
          # 1) Allows DHCP hosts to have fully qualified domain names, as long
          #     as the domain part matches this setting.
          # 2) Sets the "domain" DHCP option thereby potentially setting the
          #    domain of all systems configured by DHCP
          # 3) Provides the domain part for "expand-hosts"
          #domain=thekelleys.org.uk

          # Set a different domain for a particular subnet
          #domain=wireless.thekelleys.org.uk,192.168.2.0/24

          # Same idea, but range rather then subnet
          #domain=reserved.thekelleys.org.uk,192.68.3.100,192.168.3.200

          # Uncomment this to enable the integrated DHCP server, you need
          # to supply the range of addresses available for lease and optionally
          # a lease time. If you have more than one network, you will need to
          # repeat this for each network on which you want to supply DHCP
          # service.
          #dhcp-range=192.168.0.50,192.168.0.150,12h

          # This is an example of a DHCP range where the netmask is given. This
          # is needed for networks we reach the dnsmasq DHCP server via a relay
          # agent. If you don't know what a DHCP relay agent is, you probably
          # don't need to worry about this.
          #dhcp-range=192.168.0.50,192.168.0.150,255.255.255.0,12h

          # This is an example of a DHCP range which sets a tag, so that
          # some DHCP options may be set only for this network.
          #dhcp-range=set:red,192.168.0.50,192.168.0.150

          # Use this DHCP range only when the tag "green" is set.
          #dhcp-range=tag:green,192.168.0.50,192.168.0.150,12h

          # Specify a subnet which can't be used for dynamic address allocation,
          # is available for hosts with matching --dhcp-host lines. Note that
          # dhcp-host declarations will be ignored unless there is a dhcp-range
          # of some type for the subnet in question.
          # In this case the netmask is implied (it comes from the network
          # configuration on the machine running dnsmasq) it is possible to give
          # an explicit netmask instead.
          #dhcp-range=192.168.0.0,static

          # Enable DHCPv6. Note that the prefix-length does not need to be specified
          # and defaults to 64 if missing/
          #dhcp-range=1234::2, 1234::500, 64, 12h

          # Do Router Advertisements, BUT NOT DHCP for this subnet.
          #dhcp-range=1234::, ra-only

          # Do Router Advertisements, BUT NOT DHCP for this subnet, also try and
          # add names to the DNS for the IPv6 address of SLAAC-configured dual-stack
          # hosts. Use the DHCPv4 lease to derive the name, network segment and
          # MAC address and assume that the host will also have an
          # IPv6 address calculated using the SLAAC algorithm.
          #dhcp-range=1234::, ra-names

          # Do Router Advertisements, BUT NOT DHCP for this subnet.
          # Set the lifetime to 46 hours. (Note: minimum lifetime is 2 hours.)
          #dhcp-range=1234::, ra-only, 48h

          # Do DHCP and Router Advertisements for this subnet. Set the A bit in the RA
          # so that clients can use SLAAC addresses as well as DHCP ones.
          #dhcp-range=1234::2, 1234::500, slaac

          # Do Router Advertisements and stateless DHCP for this subnet. Clients will
          # not get addresses from DHCP, but they will get other configuration information.
          # They will use SLAAC for addresses.
          #dhcp-range=1234::, ra-stateless

          # Do stateless DHCP, SLAAC, and generate DNS names for SLAAC addresses
          # from DHCPv4 leases.
          #dhcp-range=1234::, ra-stateless, ra-names

          # Do router advertisements for all subnets where we're doing DHCPv6
          # Unless overridden by ra-stateless, ra-names, et al, the router
          # advertisements will have the M and O bits set, so that the clients
          # get addresses and configuration from DHCPv6, and the A bit reset, so the
          # clients don't use SLAAC addresses.
          #enable-ra

          # Supply parameters for specified hosts using DHCP. There are lots
          # of valid alternatives, so we will give examples of each. Note that
          # IP addresses DO NOT have to be in the range given above, they just
          # need to be on the same network. The order of the parameters in these
          # do not matter, it's permissible to give name, address and MAC in any
          # order.

          # Always allocate the host with Ethernet address 11:22:33:44:55:66
          # The IP address 192.168.0.60
          #dhcp-host=11:22:33:44:55:66,192.168.0.60

          # Always set the name of the host with hardware address
          # 11:22:33:44:55:66 to be "fred"
          #dhcp-host=11:22:33:44:55:66,fred

          # Always give the host with Ethernet address 11:22:33:44:55:66
          # the name fred and IP address 192.168.0.60 and lease time 45 minutes
          #dhcp-host=11:22:33:44:55:66,fred,192.168.0.60,45m

          # Give a host with Ethernet address 11:22:33:44:55:66 or
          # 12:34:56:78:90:12 the IP address 192.168.0.60. Dnsmasq will assume
          # that these two Ethernet interfaces will never be in use at the same
          # time, and give the IP address to the second, even if it is already
          # in use by the first. Useful for laptops with wired and wireless
          # addresses.
          #dhcp-host=11:22:33:44:55:66,12:34:56:78:90:12,192.168.0.60

          # Give the machine which says its name is "bert" IP address
          # 192.168.0.70 and an infinite lease
          #dhcp-host=bert,192.168.0.70,infinite

          # Always give the host with client identifier 01:02:02:04
          # the IP address 192.168.0.60
          #dhcp-host=id:01:02:02:04,192.168.0.60

          # Always give the InfiniBand interface with hardware address
          # 80:00:00:48:fe:80:00:00:00:00:00:00:f4:52:14:03:00:28:05:81 the
          # ip address 192.168.0.61. The client id is derived from the prefix
          # ff:00:00:00:00:00:02:00:00:02:c9:00 and the last 8 pairs of
          # hex digits of the hardware address.
          #dhcp-host=id:ff:00:00:00:00:00:02:00:00:02:c9:00:f4:52:14:03:00:28:05:81,192.168.0.61

          # Always give the host with client identifier "marjorie"
          # the IP address 192.168.0.60
          #dhcp-host=id:marjorie,192.168.0.60

          # Enable the address given for "judge" in /etc/hosts
          # to be given to a machine presenting the name "judge" when
          # it asks for a DHCP lease.
          #dhcp-host=judge

          # Never offer DHCP service to a machine whose Ethernet
          # address is 11:22:33:44:55:66
          #dhcp-host=11:22:33:44:55:66,ignore

          # Ignore any client-id presented by the machine with Ethernet
          # address 11:22:33:44:55:66. This is useful to prevent a machine
          # being treated differently when running under different OS's or
          # between PXE boot and OS boot.
          #dhcp-host=11:22:33:44:55:66,id:*

          # Send extra options which are tagged as "red" to
          # the machine with Ethernet address 11:22:33:44:55:66
          #dhcp-host=11:22:33:44:55:66,set:red

          # Send extra options which are tagged as "red" to
          # any machine with Ethernet address starting 11:22:33:
          #dhcp-host=11:22:33:*:*:*,set:red

          # Give a fixed IPv6 address and name to client with
          # DUID 00:01:00:01:16:d2:83:fc:92:d4:19:e2:d8:b2
          # Note the MAC addresses CANNOT be used to identify DHCPv6 clients.
          # Note also that the [] around the IPv6 address are obligatory.
          #dhcp-host=id:00:01:00:01:16:d2:83:fc:92:d4:19:e2:d8:b2, fred, [1234::5]

          # Ignore any clients which are not specified in dhcp-host lines
          # or /etc/ethers. Equivalent to ISC "deny unknown-clients".
          # This relies on the special "known" tag which is set when
          # a host is matched.
          #dhcp-ignore=tag:!known

          # Send extra options which are tagged as "red" to any machine whose
          # DHCP vendorclass string includes the substring "Linux"
          #dhcp-vendorclass=set:red,Linux

          # Send extra options which are tagged as "red" to any machine one
          # of whose DHCP userclass strings includes the substring "accounts"
          #dhcp-userclass=set:red,accounts

          # Send extra options which are tagged as "red" to any machine whose
          # MAC address matches the pattern.
          #dhcp-mac=set:red,00:60:8C:*:*:*

          # If this line is uncommented, dnsmasq will read /etc/ethers and act
          # on the ethernet-address/IP pairs found there just as if they had
          # been given as --dhcp-host options. Useful if you keep
          # MAC-address/host mappings there for other purposes.
          #read-ethers

          # Send options to hosts which ask for a DHCP lease.
          # See RFC 2132 for details of available options.
          # Common options can be given to dnsmasq by name:
          # run "dnsmasq --help dhcp" to get a list.
          # Note that all the common settings, such as netmask and
          # broadcast address, DNS server and default route, are given
          # sane defaults by dnsmasq. You very likely will not need
          # any dhcp-options. If you use Windows clients and Samba, there
          # are some options which are recommended, they are detailed at the
          # end of this section.

          # Override the default route supplied by dnsmasq, which assumes the
          # router is the same machine as the one running dnsmasq.
          #dhcp-option=3,1.2.3.4

          # Do the same thing, but using the option name
          #dhcp-option=option:router,1.2.3.4

          # Override the default route supplied by dnsmasq and send no default
          # route at all. Note that this only works for the options sent by
          # default (1, 3, 6, 12, 28) the same line will send a zero-length option
          # for all other option numbers.
          #dhcp-option=3

          # Set the NTP time server addresses to 192.168.0.4 and 10.10.0.5
          #dhcp-option=option:ntp-server,192.168.0.4,10.10.0.5

          # Send DHCPv6 option. Note [] around IPv6 addresses.
          #dhcp-option=option6:dns-server,[1234::77],[1234::88]

          # Send DHCPv6 option for namservers as the machine running
          # dnsmasq and another.
          #dhcp-option=option6:dns-server,[::],[1234::88]

          # Ask client to poll for option changes every six hours. (RFC4242)
          #dhcp-option=option6:information-refresh-time,6h

          # Set option 58 client renewal time (T1). Defaults to half of the
          # lease time if not specified. (RFC2132)
          #dhcp-option=option:T1,1m

          # Set option 59 rebinding time (T2). Defaults to 7/8 of the
          # lease time if not specified. (RFC2132)
          #dhcp-option=option:T2,2m

          # Set the NTP time server address to be the same machine as
          # is running dnsmasq
          #dhcp-option=42,0.0.0.0

          # Set the NIS domain name to "welly"
          #dhcp-option=40,welly

          # Set the default time-to-live to 50
          #dhcp-option=23,50

          # Set the "all subnets are local" flag
          #dhcp-option=27,1

          # Send the etherboot magic flag and then etherboot options (a string).
          #dhcp-option=128,e4:45:74:68:00:00
          #dhcp-option=129,NIC=eepro100

          # Specify an option which will only be sent to the "red" network
          # (see dhcp-range for the declaration of the "red" network)
          # Note that the tag: part must precede the option: part.
          #dhcp-option = tag:red, option:ntp-server, 192.168.1.1

          # The following DHCP options set up dnsmasq in the same way as is specified
          # for the ISC dhcpcd in
          # https://web.archive.org/web/20040313070105/http://us1.samba.org/samba/ftp/docs/textdocs/DHCP-Server-Configuration.txt
          # adapted for a typical dnsmasq installation where the host running
          # dnsmasq is also the host running samba.
          # you may want to uncomment some or all of them if you use
          # Windows clients and Samba.
          #dhcp-option=19,0           # option ip-forwarding off
          #dhcp-option=44,0.0.0.0     # set netbios-over-TCP/IP nameserver(s) aka WINS server(s)
          #dhcp-option=45,0.0.0.0     # netbios datagram distribution server
          #dhcp-option=46,8           # netbios node type

          # Send an empty WPAD option. This may be REQUIRED to get windows 7 to behave.
          #dhcp-option=252,"\n"

          # Send RFC-3397 DNS domain search DHCP option. WARNING: Your DHCP client
          # probably doesn't support this......
          #dhcp-option=option:domain-search,eng.apple.com,marketing.apple.com

          # Send RFC-3442 classless static routes (note the netmask encoding)
          #dhcp-option=121,192.168.1.0/24,1.2.3.4,10.0.0.0/8,5.6.7.8

          # Send vendor-class specific options encapsulated in DHCP option 43.
          # The meaning of the options is defined by the vendor-class so
          # options are sent only when the client supplied vendor class
          # matches the class given here. (A substring match is OK, so "MSFT"
          # matches "MSFT" and "MSFT 5.0"). This example sets the
          # mtftp address to 0.0.0.0 for PXEClients.
          #dhcp-option=vendor:PXEClient,1,0.0.0.0

          # Send microsoft-specific option to tell windows to release the DHCP lease
          # when it shuts down. Note the "i" flag, to tell dnsmasq to send the
          # value as a four-byte integer - that's what microsoft wants. See
          # http://technet2.microsoft.com/WindowsServer/en/library/a70f1bb7-d2d4-49f0-96d6-4b7414ecfaae1033.mspx?mfr=true
          #dhcp-option=vendor:MSFT,2,1i

          # Send the Encapsulated-vendor-class ID needed by some configurations of
          # Etherboot to allow is to recognise the DHCP server.
          #dhcp-option=vendor:Etherboot,60,"Etherboot"

          # Send options to PXELinux. Note that we need to send the options even
          # though they don't appear in the parameter request list, so we need
          # to use dhcp-option-force here.
          # See http://syslinux.zytor.com/pxe.php#special for details.
          # Magic number - needed before anything else is recognised
          #dhcp-option-force=208,f1:00:74:7e
          # Configuration file name
          #dhcp-option-force=209,configs/common
          # Path prefix
          #dhcp-option-force=210,/tftpboot/pxelinux/files/
          # Reboot time. (Note 'i' to send 32-bit value)
          #dhcp-option-force=211,30i

          # Set the boot filename for netboot/PXE. You will only need
          # this if you want to boot machines over the network and you will need
          # a TFTP server; either dnsmasq's built-in TFTP server or an
          # external one. (See below for how to enable the TFTP server.)
          #dhcp-boot=pxelinux.0

          # The same as above, but use custom tftp-server instead machine running dnsmasq
          #dhcp-boot=pxelinux,server.name,192.168.1.100

          # Boot for iPXE. The idea is to send two different
          # filenames, the first loads iPXE, and the second tells iPXE what to
          # load. The dhcp-match sets the ipxe tag for requests from iPXE.
          #dhcp-boot=undionly.kpxe
          #dhcp-match=set:ipxe,175 # iPXE sends a 175 option.
          #dhcp-boot=tag:ipxe,http://boot.ipxe.org/demo/boot.php

          # Encapsulated options for iPXE. All the options are
          # encapsulated within option 175
          #dhcp-option=encap:175, 1, 5b         # priority code
          #dhcp-option=encap:175, 176, 1b       # no-proxydhcp
          #dhcp-option=encap:175, 177, string   # bus-id
          #dhcp-option=encap:175, 189, 1b       # BIOS drive code
          #dhcp-option=encap:175, 190, user     # iSCSI username
          #dhcp-option=encap:175, 191, pass     # iSCSI password

          # Test for the architecture of a netboot client. PXE clients are
          # supposed to send their architecture as option 93. (See RFC 4578)
          #dhcp-match=peecees, option:client-arch, 0 #x86-32
          #dhcp-match=itanics, option:client-arch, 2 #IA64
          #dhcp-match=hammers, option:client-arch, 6 #x86-64
          #dhcp-match=mactels, option:client-arch, 7 #EFI x86-64

          # Do real PXE, rather than just booting a single file, this is an
          # alternative to dhcp-boot.
          #pxe-prompt="What system shall I netboot?"
          # or with timeout before first available action is taken:
          #pxe-prompt="Press F8 for menu.", 60

          # Available boot services. for PXE.
          #pxe-service=x86PC, "Boot from local disk"

          # Loads <tftp-root>/pxelinux.0 from dnsmasq TFTP server.
          #pxe-service=x86PC, "Install Linux", pxelinux

          # Loads <tftp-root>/pxelinux.0 from TFTP server at 1.2.3.4.
          # Beware this fails on old PXE ROMS.
          #pxe-service=x86PC, "Install Linux", pxelinux, 1.2.3.4

          # Use bootserver on network, found my multicast or broadcast.
          #pxe-service=x86PC, "Install windows from RIS server", 1

          # Use bootserver at a known IP address.
          #pxe-service=x86PC, "Install windows from RIS server", 1, 1.2.3.4

          # If you have multicast-FTP available,
          # information for that can be passed in a similar way using options 1
          # to 5. See page 19 of
          # http://download.intel.com/design/archives/wfm/downloads/pxespec.pdf


          # Enable dnsmasq's built-in TFTP server
          #enable-tftp

          # Set the root directory for files available via FTP.
          #tftp-root=/var/ftpd

          # Do not abort if the tftp-root is unavailable
          #tftp-no-fail

          # Make the TFTP server more secure: with this set, only files owned by
          # the user dnsmasq is running as will be send over the net.
          #tftp-secure

          # This option stops dnsmasq from negotiating a larger blocksize for TFTP
          # transfers. It will slow things down, but may rescue some broken TFTP
          # clients.
          #tftp-no-blocksize

          # Set the boot file name only when the "red" tag is set.
          #dhcp-boot=tag:red,pxelinux.red-net

          # An example of dhcp-boot with an external TFTP server: the name and IP
          # address of the server are given after the filename.
          # Can fail with old PXE ROMS. Overridden by --pxe-service.
          #dhcp-boot=/var/ftpd/pxelinux.0,boothost,192.168.0.3

          # If there are multiple external tftp servers having a same name
          # (using /etc/hosts) then that name can be specified as the
          # tftp_servername (the third option to dhcp-boot) and in that
          # case dnsmasq resolves this name and returns the resultant IP
          # addresses in round robin fashion. This facility can be used to
          # load balance the tftp load among a set of servers.
          #dhcp-boot=/var/ftpd/pxelinux.0,boothost,tftp_server_name

          # Set the limit on DHCP leases, the default is 150
          #dhcp-lease-max=150

          # The DHCP server needs somewhere on disk to keep its lease database.
          # This defaults to a sane location, but if you want to change it, use
          # the line below.
          #dhcp-leasefile=/var/lib/misc/dnsmasq.leases

          # Set the DHCP server to authoritative mode. In this mode it will barge in
          # and take over the lease for any client which broadcasts on the network,
          # whether it has a record of the lease or not. This avoids long timeouts
          # when a machine wakes up on a new network. DO NOT enable this if there's
          # the slightest chance that you might end up accidentally configuring a DHCP
          # server for your campus/company accidentally. The ISC server uses
          # the same option, and this URL provides more information:
          # http://www.isc.org/files/auth.html
          #dhcp-authoritative

          # Set the DHCP server to enable DHCPv4 Rapid Commit Option per RFC 4039.
          # In this mode it will respond to a DHCPDISCOVER message including a Rapid Commit
          # option with a DHCPACK including a Rapid Commit option and fully committed address
          # and configuration information. This must only be enabled if either the server is
          # the only server for the subnet, or multiple servers are present and they each
          # commit a binding for all clients.
          #dhcp-rapid-commit

          # Run an executable when a DHCP lease is created or destroyed.
          # The arguments sent to the script are "add" or "del",
          # then the MAC address, the IP address and finally the hostname
          # if there is one.
          #dhcp-script=/bin/echo

          # Set the cachesize here.
          #cache-size=150

          # If you want to disable negative caching, uncomment this.
          #no-negcache

          # Normally responses which come from /etc/hosts and the DHCP lease
          # file have Time-To-Live set as zero, which conventionally means
          # do not cache further. If you are happy to trade lower load on the
          # server for potentially stale date, you can set a time-to-live (in
          # seconds) here.
          #local-ttl=

          # If you want dnsmasq to detect attempts by Verisign to send queries
          # to unregistered .com and .net hosts to its sitefinder service and
          # have dnsmasq instead return the correct NXDOMAIN response, uncomment
          # this line. You can add similar lines to do the same for other
          # registries which have implemented wildcard A records.
          #bogus-nxdomain=64.94.110.11

          # If you want to fix up DNS results from upstream servers, use the
          # alias option. This only works for IPv4.
          # This alias makes a result of 1.2.3.4 appear as 5.6.7.8
          #alias=1.2.3.4,5.6.7.8
          # and this maps 1.2.3.x to 5.6.7.x
          #alias=1.2.3.0,5.6.7.0,255.255.255.0
          # and this maps 192.168.0.10->192.168.0.40 to 10.0.0.10->10.0.0.40
          #alias=192.168.0.10-192.168.0.40,10.0.0.0,255.255.255.0

          # Change these lines if you want dnsmasq to serve MX records.

          # Return an MX record named "maildomain.com" with target
          # servermachine.com and preference 50
          #mx-host=maildomain.com,servermachine.com,50

          # Set the default target for MX records created using the localmx option.
          #mx-target=servermachine.com

          # Return an MX record pointing to the mx-target for all local
          # machines.
          #localmx

          # Return an MX record pointing to itself for all local machines.
          #selfmx

          # Change the following lines if you want dnsmasq to serve SRV
          # records.  These are useful if you want to serve ldap requests for
          # Active Directory and other windows-originated DNS requests.
          # See RFC 2782.
          # You may add multiple srv-host lines.
          # The fields are <name>,<target>,<port>,<priority>,<weight>
          # If the domain part if missing from the name (so that is just has the
          # service and protocol sections) then the domain given by the domain=
          # config option is used. (Note that expand-hosts does not need to be
          # set for this to work.)

          # A SRV record sending LDAP for the example.com domain to
          # ldapserver.example.com port 389
          #srv-host=_ldap._tcp.example.com,ldapserver.example.com,389

          # A SRV record sending LDAP for the example.com domain to
          # ldapserver.example.com port 389 (using domain=)
          #domain=example.com
          #srv-host=_ldap._tcp,ldapserver.example.com,389

          # Two SRV records for LDAP, each with different priorities
          #srv-host=_ldap._tcp.example.com,ldapserver.example.com,389,1
          #srv-host=_ldap._tcp.example.com,ldapserver.example.com,389,2

          # A SRV record indicating that there is no LDAP server for the domain
          # example.com
          #srv-host=_ldap._tcp.example.com

          # The following line shows how to make dnsmasq serve an arbitrary PTR
          # record. This is useful for DNS-SD. (Note that the
          # domain-name expansion done for SRV records _does_not
          # occur for PTR records.)
          #ptr-record=_http._tcp.dns-sd-services,"New Employee Page._http._tcp.dns-sd-services"

          # Change the following lines to enable dnsmasq to serve TXT records.
          # These are used for things like SPF and zeroconf. (Note that the
          # domain-name expansion done for SRV records _does_not
          # occur for TXT records.)

          #Example SPF.
          #txt-record=example.com,"v=spf1 a -all"

          #Example zeroconf
          #txt-record=_http._tcp.example.com,name=value,paper=A4

          # Provide an alias for a "local" DNS name. Note that this _only_ works
          # for targets which are names from DHCP or /etc/hosts. Give host
          # "bert" another name, bertrand
          #cname=bertrand,bert

          # For debugging purposes, log each DNS query as it passes through
          # dnsmasq.
          #log-queries

          # Log lots of extra information about DHCP transactions.
          #log-dhcp

          # Include another lot of configuration options.
          #conf-file=/etc/dnsmasq.more.conf
          #conf-dir=/etc/dnsmasq.d

          # Include all the files in a directory except those ending in .bak
          #conf-dir=/etc/dnsmasq.d,.bak

          # Include all files in a directory which end in .conf
          #conf-dir=/etc/dnsmasq.d/,*.conf

          # If a DHCP client claims that its name is "wpad", ignore that.
          # This fixes a security hole. see CERT Vulnerability VU#598349
          #dhcp-name-match=set:wpad-ignore,wpad
          #dhcp-ignore-names=tag:wpad-ignore
      - name: boot.sh
        content: |-
          # insert more commands here
          ip address add 192.168.255.1/24 dev eth0
          ip link set up dev eth0
          #
          # keep the next line to indicate that the machine is ready
          echo "READY" >/dev/console
          exit 0
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n6
    image_definition: null
    label: Rogue_DHCP
    node_definition: dnsmasq
    parameters: {}
    ram: null
    tags: []
    x: -320
    y: -40
    interfaces:
      - id: i0
        label: eth0
        mac_address: null
        type: physical
        slot: 0
      - id: i1
        label: eth1
        mac_address: null
        type: physical
        slot: 1
      - id: i2
        label: eth2
        mac_address: null
        type: physical
        slot: 2
      - id: i3
        label: eth3
        mac_address: null
        type: physical
        slot: 3
links:
  - id: l0
    n1: n4
    n2: n0
    i1: i2
    i2: i0
    conditioning: {}
    label: iosvl2-0-GigabitEthernet0/1<->PC1-eth0
  - id: l1
    n1: n1
    n2: n4
    i1: i0
    i2: i3
    conditioning: {}
    label: PC2-eth0<->iosvl2-0-GigabitEthernet0/2
  - id: l2
    n1: n2
    n2: n4
    i1: i0
    i2: i4
    conditioning: {}
    label: PC3-eth0<->iosvl2-0-GigabitEthernet0/3
  - id: l3
    n1: n5
    n2: n4
    i1: i1
    i2: i1
    conditioning: {}
    label: DSW-GigabitEthernet0/0<->ASW-GigabitEthernet0/0
  - id: l4
    n1: n5
    n2: n3
    i1: i2
    i2: i0
    conditioning: {}
    label: DSW-GigabitEthernet0/1<->Internet-port
  - id: l5
    n1: n4
    n2: n6
    i1: i5
    i2: i0
    conditioning: {}
    label: ASW-GigabitEthernet1/0<->Rogue_DHCP-eth0
lab:
  description: ''
  notes: |-
    **CCNA Exam Prep: Back to Networking Basics with Hank Preston and Patrick Gargano -- Season 3**

    # Securing the Switch with Essential Layer 2 Protections

    Layer 2 device hardening is essential to ensure that your network infrastructure is protected against unauthorized access, MAC spoofing, ARP poisoning, and potential attacks like CAM table overflow or DHCP starvation. Port security limits and identifies MAC addresses on switch ports. DHCP snooping prevents unauthorized DHCP servers from assigning IP addresses, protecting against rogue DHCP attacks. Dynamic ARP inspection (DAI) validates ARP packets to prevent man-in-the-middle attacks by ensuring IP-to-MAC address bindings are correct. Together, these three tools help protect Layer 2 devices from common threats, thereby enhancing the overall security posture of your network infrastructure.

    Related CCNA v1.1 exam topic:
    * 5.7  Configure and verify Layer 2 security features (DHCP snooping, dynamic ARP inspection, and port security)

    In this lab, you will explore how to:
    * Configure and explore the different Cisco port security options
    * Configure and verify DHCP snooping
    * Configure and verify DAI

    ## Setup and Scenario
    In this set of lab-based demonstrations, you are a network engineer tasked with deploying Layer 2 security on Cisco switches.

    You've been asked to:

    * Configure port-security
    * Configure DHCP snooping
    * Configure DAI

    *Be sure to **START** the lab **except for the Rogue DHCP server** before continuing*

    > Note: The credentials for all devices are **cisco / cisco**

    > Note: The IOL-L2 image does not support DHCP Snooping or DAI. This lab use the IOSvL2 image instead to demonstrate these features.

    ## Part 1: Reviewing the current network configuration
    Before we jump into configuring any Layer 2 security features, let's explore the current network configuration.

    ### Step 1
    Open a console connection to the ``DSW`` switch and use the ``show run`` command. Some output has been omitted for simplicity.

    <pre>
    DSW# <b>show run</b>
    !
    hostname DSW
    !
    vlan 10
     name CCNAPREP
    !
    interface GigabitEthernet0/0
     switchport mode access
     switchport access vlan 10
     negotiation auto
    !
    interface GigabitEthernet0/1
     switchport trunk encapsulation dot1q
     switchport mode trunk
     negotiation auto
    !
    </pre>

    Notice that the DSW switch is configured for VLAN 10. DHCP requests from the PCs are forwarded to the Internet (external connector) where the CML server is responding with addresses from the 192.168.255.0/24 network.

    Open a console connection to the ``ASW`` switch and use the ``show run`` command. Some output has been omitted for simplicity.

    <pre>
    ASW# <b>show run</b>
    !
    hostname ASW
    !
    vlan 10
     name CCNAPREP
    !
    interface GigabitEthernet0/0
     switchport trunk encapsulation dot1q
     switchport mode trunk
     negotiation auto
    !
    interface GigabitEthernet0/1
     switchport access vlan 10
     switchport mode access
     negotiation auto
     spanning-tree portfast edge
    !
    interface GigabitEthernet0/2
     switchport access vlan 10
     switchport mode access
     negotiation auto
     spanning-tree portfast edge
    !
    interface GigabitEthernet0/3
     switchport access vlan 10
     switchport mode access
     negotiation auto
     spanning-tree portfast edge
    !
    </pre>

    Notice that the ASW switch is configured to support VLAN 10 on interfaces connected to the PCs in the topology. Portfast is enabled to speed up the transition to the STP Forwarding state, ensuring DHCP requests are quickly received and sent to the external CML DHCP server.

    The G1/0 interface will be used in Part 5 to connect the DHCP rogue server. The DHCP rogue server will also be turned on in Part 5.

    ### Step 2
    Verify the IP address assignment on PC1, PC2, and PC3.

    <pre>
    PC1:~$ <b>ifconfig eth0</b>
    eth0      Link encap:Ethernet  HWaddr 52:54:00:11:11:11
              inet addr:<mark>192.168.255.227</mark>  Bcast:192.168.255.255  Mask:255.255.255.0

    PC2:~$ <b>ifconfig eth0</b>
    eth0      Link encap:Ethernet  HWaddr 52:54:00:22:22:22
              inet addr:<mark>192.168.255.175</mark>  Bcast:192.168.255.255  Mask:255.255.255.0

    PC3:~$ <b>ifconfig eth0</b>
    eth0      Link encap:Ethernet  HWaddr 52:54:00:33:33:33
              inet addr:<mark>192.168.255.123</mark>  Bcast:192.168.255.255  Mask:255.255.255.0
    </pre>

    All three PCs should have received an IP address from the CML DHCP server. Your results might differ from the output above.

    ### Step 3
    Verify the MAC table on ASW.

    <pre>
    ASW# <b>show mac address-table</b>
              Mac Address Table
    -------------------------------------------

    Vlan    Mac Address       Type        Ports
    ----    -----------       --------    -----
       1    5254.0040.4cad    DYNAMIC     Gi0/0
      10    5254.0011.1111    DYNAMIC     Gi0/1
      10    5254.0022.2222    DYNAMIC     Gi0/2
      10    5254.0033.3333    DYNAMIC     Gi0/3
      10    5254.0040.4cad    DYNAMIC     Gi0/0
      10    5254.0054.1adc    DYNAMIC     Gi0/0
    Total Mac Addresses for this criterion: 6
    </pre>

    You should see all three PC's MAC addresses in the MAC table connected to Gi0/1, Gi0/2, and Gi0/3.

    PC1 = 5254.0011.1111

    PC2 = 5254.0022.2222

    PC3 = 5254.0033.3333

    These three dynamic MAC addresses will be converted to secure MAC addresses once port security is enabled in the next part of the lab.

    ## Part 2: Configure and explore port security
    Let's start by reviewing some of the basics concepts relating to port security.

    Recall that there are three ways that a Cisco switch can learn secure MAC addresses:
    * <b>Static</b> secure MAC addresses that are manually configured on a port.
    * <b>Dynamic</b> secure MAC addresses that are learned automatically up to a maximum number.
    * <b>Sticky</b> secure MAC addresses that are dynamically learned and then stored in the running configuration.

    There are three types of port security violations:
    * <b>Protect</b> (quietly drops the offending frame)
    * <b>Restrict</b> (drops the offending frame, generates a Syslog message and a SNMP trap, and increments the violation counter)
    * <b>Shutdown</b> (drops the offending frame, the interface is placed in an err-disabled/inactive state, a Syslog message and SNMP trap are generated, and the violation counter is incremented)

    Note that there are a few extra optional parameters that can be configured for port security:
    * The default maximum number of secure MAC addresses on an interface is <b>1</b>.
    * The default aging time for dynamic secure MAC addresses is set to <b>0</b> and the default aging type is set to <b>absolute</b>.
    * <b>Static</b> secure MAC addresses and <b>sticky</b> secure MAC addresses do not age out. The aging time only applies to dynamic secure MAC addresses.

    ### Step 1
    Configure a static secure MAC address on port ASW Gi0/1 for PC1. Change the violation type to protect.

    <pre>
    ASW# config t
    ASW(config)# interface gi0/1
    ASW(config-if)# switchport port-security mac-address 5254.0011.1111
    ASW(config-if)# switchport port-security violation protect
    ASW(config-if)# switchport port-security
    ASW(config-if)# exit
    </pre>

    ### Step 2
    Configure a dynamic secure MAC address on port ASW Gi0/2 for PC2. Change the violation type to restrict. Set the aging time to 30 minutes and the aging type to inactivity.

    <pre>
    ASW(config)# interface gi0/2
    ASW(config-if)# switchport port-security violation restrict
    ASW(config-if)# switchport port-security aging time 30
    ASW(config-if)# switchport port-security aging type inactivity
    ASW(config-if)# switchport port-security
    ASW(config-if)# exit
    </pre>

    ### Step 3

    Configure a sticky secure MAC address on port ASW Gi0/3 for PC3. Keep the default violation of shutdown enabled.

    <pre>
    ASW(config)# interface gi0/3
    ASW(config-if)# switchport port-security mac-address sticky
    ASW(config-if)# switchport port-security
    ASW(config-if)# exit
    ASW(config)# exit
    </pre>

    ### Step 4
    Verify the port security configuration. To ensure that the dynamic and sticky MAC addresses are learned by the switch, <b>ping 8.8.8.8 from each PC</b> before proceeding with the following verification steps.

    <pre>
    ASW# <b>show port-security</b>
    Secure Port  MaxSecureAddr  CurrentAddr  SecurityViolation  Security Action
                    (Count)       (Count)          (Count)
    ---------------------------------------------------------------------------
          Gi0/1              1            1                  0          Protect
          Gi0/2              1            1                  0         Restrict
          Gi0/3              1            1                  0         Shutdown
    ---------------------------------------------------------------------------
    Total Addresses in System (excluding one mac per port)     : 0
    Max Addresses limit in System (excluding one mac per port) : 4096
    </pre>

    The output above confirms that each port is configured for a default maximum of 1 secure MAC address and that the current count is 1. No violations have occurred yet so the counter shows 0. The last column confirms the current violation mode.

    <pre>
    ASW# <b>show port-security address</b>
                   Secure Mac Address Table
    -------------------------------------------------------------------------------
    Vlan    Mac Address       Type                          Ports   Remaining Age
                                                                       (mins)
    ----    -----------       ----                          -----   -------------
      10    5254.0011.1111    SecureConfigured              Gi0/1        -
      10    5254.0022.2222    SecureDynamic                 Gi0/2       26 (I)
      10    5254.0033.3333    SecureSticky                  Gi0/3        -
    -------------------------------------------------------------------------------
    Total Addresses in System (excluding one mac per port)     : 0
    Max Addresses limit in System (excluding one mac per port) : 4096
    </pre>

    The output above displays the current secure MAC addresses and how they were learned by the switch, either statically, dynamically, or by using the sticky option. The aging time for PC2 should have started to decrement from configured value of 30 minutes and if no activity is detected before the timer elapses, the dynamic secure MAC address will age out.

    <pre>
    ASW# <b>show port-security interface Gi0/1</b>
    Port Security              : Enabled
    Port Status                : Secure-up
    Violation Mode             : Protect
    Aging Time                 : 0 mins
    Aging Type                 : Absolute
    SecureStatic Address Aging : Disabled
    Maximum MAC Addresses      : 1
    Total MAC Addresses        : 1
    <mark>Configured MAC Addresses   : 1</mark>
    Sticky MAC Addresses       : 0
    Last Source Address:Vlan   : 5254.0011.1111:10
    Security Violation Count   : 0
    </pre>

    The output above shows the current state of the port security configuration on port Gi0/1. The port is up and the current static secure MAC address will never age out.

    <pre>
    ASW#show port-security interface gi0/2
    Port Security              : Enabled
    Port Status                : Secure-up
    Violation Mode             : Restrict
    Aging Time                 : 30 mins
    Aging Type                 : Inactivity
    SecureStatic Address Aging : Disabled
    Maximum MAC Addresses      : 1
    <mark>Total MAC Addresses        : 1</mark>
    Configured MAC Addresses   : 0
    Sticky MAC Addresses       : 0
    Last Source Address:Vlan   : 5254.0022.2222:10
    Security Violation Count   : 0
    </pre>

    The output above shows the current state of the port security configuration on port Gi0/2. The port is up and the current dynamic secure MAC address will age out after 30 minutes of inactivity.

    <pre>
    ASW#show port-security interface gi0/3
    Port Security              : Enabled
    Port Status                : Secure-up
    Violation Mode             : Shutdown
    Aging Time                 : 0 mins
    Aging Type                 : Absolute
    SecureStatic Address Aging : Disabled
    Maximum MAC Addresses      : 1
    Total MAC Addresses        : 1
    Configured MAC Addresses   : 0
    <mark>Sticky MAC Addresses       : 1</mark>
    Last Source Address:Vlan   : 5254.0033.3333:10
    Security Violation Count   : 0
    </pre>

    The output above shows the current state of the port security configuration on port Gi0/3. The port is up and the current sticky secure MAC address will never age out.

    ### Step 5
    Change the MAC address on PC1 to cause a port security violation on ASW Gi0/1 and observe the results.

    Stop and wipe PC1. Select the Interfaces tab and change the last two hex digits of the MAC address to 00 so that the new MAC address is 5254:0011:1100. Select the checkmark to apply the change and restart the PC. Wait a few moments for PC1 to reboot.

    Because interface Gi0/1 is set to a violation mode of protect, you will not see any syslog messages at the AWS switch console and the violation counter will not increment. To confirm that port security is operation, you can see that PC1 did not receive a new IP address from the CML DHCP server and the offending MAC address is shown in the ``show port-security interface`` output.

    Stop and wipe PC1 and reconfigure its original MAC address of 5254:0011:1111.

    ### Step 6
    Change the MAC address on PC2 to cause a port security violation on ASW Gi0/2 and observe the results.

    Stop and wipe PC2. Select the Interfaces tab and change the last two hex digits of the MAC address to 00 so that the new MAC address is 5254:0022:2200. Select the checkmark to apply the change and restart the PC. Wait a few moments for PC2 to reboot.

    Because interface Gi0/2 is set to a violation mode of restrict, you will see multiple syslog messages, as follows:

    <pre>
    *Oct 17 18:59:46.342: %PORT_SECURITY-2-PSECURE_VIOLATION: Security violation occurred, caused by MAC address 5254.0022.2200 on port GigabitEthernet0/2.
    </pre>

    The message confirms the violating MAC address of 5254:0022:2200 on Gi0/2 but the port remains active. PC2 continue to send DHCP Discover messages to ASW causing an increasing number of violations. You can see the violation counter increase by using the ``show port-security`` command.

    Stop and wipe PC2 and reconfigure its original MAC address of 5254:0022:2222.

    ### Step 7
    Change the MAC address on PC3 to cause a port security violation on ASW Gi0/3 and observe the results.

    Stop and wipe PC3. Select the Interfaces tab and change the last two hex digits of the MAC address to 00 so that the new MAC address is 5254:0033:3300. Select the checkmark to apply the change and restart the PC. Wait a few moments for PC3 to reboot.

    Because interface Gi0/3 is set to a violation mode of shutdown, you will see multiple syslog messages, as follows:

    <pre>
    ASW#
    *Oct 17 19:09:42.050: %PM-4-ERR_DISABLE: psecure-violation error detected on Gi0/3, putting Gi0/3 in err-disable state
    ASW#
    *Oct 17 19:09:42.050: %PORT_SECURITY-2-PSECURE_VIOLATION: Security violation occurred, caused by MAC address 5254.0033.3300 on port GigabitEthernet0/3.
    ASW#
    *Oct 17 19:09:43.051: %LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/3, changed state to down
    ASW#
    *Oct 17 19:09:44.050: %LINK-3-UPDOWN: Interface GigabitEthernet0/3, changed state to down
    </pre>

    The message confirms the violating MAC address of 5254:0033:3300 on Gi0/3 and the port is put into the ``err-disable`` state and the interface is placed in the down/down state. Use the following commands to investigate the port security violation:

    <pre>
    ASW# <b>show interfaces status err-disabled </b>
    Port         Name         Status       Reason               Err-disabled Vlans

    Gi0/3                     err-disabled psecure-violation

    ASW# <b>show port-security int gi0/3</b>
    Port Security              : Enabled
    Port Status                : Secure-shutdown
    Violation Mode             : Shutdown
    Aging Time                 : 0 mins
    Aging Type                 : Absolute
    SecureStatic Address Aging : Disabled
    Maximum MAC Addresses      : 1
    Total MAC Addresses        : 1
    Configured MAC Addresses   : 0
    Sticky MAC Addresses       : 1
    Last Source Address:Vlan   : 5254.0033.3300:10
    Security Violation Count   : 1
    </pre>

    PC3 will continue to send DHCP Discover messages but these are dropped by ASW since the Gi0/3 interface is in a ``Secure-shutdown`` state. The offending MAC address is shown in the output and the violation counter was incremented to 1.

    Stop and wipe PC3 and reconfigure its original MAC address of 5254:0033:3333.

    Doing so will not automatically bring the Gi0/3 interface out of its ``err-disabled`` state. There are two ways of reenabling Gi0/3:

    <b>Option 1:</b> Manually reenable the port by entering ``shutdown`` followed by ``no shutdown`` on Gi0/3 once the offending MAC has been removed.</b>

    <b>Option 2:</b> Enter the ``errdisable recovery cause psecure-violation`` global configuration command on ASW. The default timeout for recovery is 5 minutes. You can adjust the recovery time with the following command: <pre>errdisable recovery intervale *time-interval*</pre>

    The following output shows what is displayed at the console when using the automatic recovery feature on a Cisco switch:
    <pre>
    ASW#
    *Oct 17 19:30:04.306: %PM-4-ERR_RECOVER: Attempting to recover from psecure-violation err-disable state on Gi0/3
    ASW#
    *Oct 17 19:30:06.306: %LINK-3-UPDOWN: Interface GigabitEthernet0/3, changed state to up
    ASW#
    *Oct 17 19:30:07.306: %LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/3, changed state to up
    ASW#
    </pre>

    Ensure that Gi0/3 is up/up before continuing the lab.

    Stop and restart PC1, PC2 and PC3, and verify that they can ping 8.8.8.8 before continuing to Part 3 of the lab.


    ## Part 3: Configure and verify DHCP Snooping
    In Part 3 you will enable DHCP snooping on ASW for VLAN 10 and ensure that the trunk link to DSW is trusted since that is the uplink that will received legitimate DHCP messages from the CML DHCP server. You will also configure DHCP snooping on DSW.

    ### Step 1
    On ASW, globally enable DHCP snooping and enable it for VLAN 10. Configure DHCP snooping MAC address validation and limit the number of DHCP messages to 10 packets per second on all untrusted ports. Configure Gi0/0 as a DHCP snooping trusted port.

    <pre>
    ASW(config)# ip dhcp snooping
    ASW(config)# ip dhcp snooping vlan 10
    ASW(config)# ip dhcp snooping verify mac-address
    ASW(config)# interface range gi0/1-3
    ASW(config-if-range)# ip dhcp snooping limit rate 10
    ASW(config-if-range)# interface gi0/0
    ASW(config-if)# ip dhcp snooping trust
    </pre>

    ### Step2
    Verify the DHCP snooping configuration.

    <pre>
    ASW# <b>show ip dhcp snooping</b>
    <mark>Switch DHCP snooping is enabled</mark>
    Switch DHCP gleaning is disabled
    <mark>DHCP snooping is configured on following VLANs:
    10
    DHCP snooping is operational on following VLANs:
    10</mark>
     Proxy bridge is configured on following VLANs:
    none
     Proxy bridge is operational on following VLANs:
    none
    DHCP snooping is configured on the following L3 Interfaces:

    Insertion of option 82 is enabled
       circuit-id default format: vlan-mod-port
       remote-id: aabb.cc00.0e00 (MAC)
    Option 82 on untrusted port is not allowed
    <mark>Verification of hwaddr field is enabled</mark>
    Verification of giaddr field is enabled
    DHCP snooping trust/rate is configured on the following Interfaces:

    Interface                  Trusted    Allow option    Rate limit (pps)
    -----------------------    -------    ------------    ----------------
    GigabitEthernet0/0         <mark>yes</mark>        yes             unlimited
      Custom circuit-ids:
    GigabitEthernet0/1         no         no              <mark>10</mark>
      Custom circuit-ids:
    GigabitEthernet0/2         no         no              10
      Custom circuit-ids:
    GigabitEthernet0/3         no         no              10
      Custom circuit-ids:
    </pre>

    Verify the MAC to IP snooping bindings that are built by ASW:

    <pre>
    ASW# <b>show ip dhcp snooping binding</b>
    MacAddress          IpAddress        Lease(sec)  Type           VLAN  Interface
    ------------------  ---------------  ----------  -------------  ----  --------------------
    52:54:00:33:33:33   192.168.255.123  3577        dhcp-snooping   10    GigabitEthernet0/3
    52:54:00:11:11:11   192.168.255.227  3563        dhcp-snooping   10    GigabitEthernet0/1
    52:54:00:22:22:22   192.168.255.175  3570        dhcp-snooping   10    GigabitEthernet0/2
    Total number of bindings: 3
    </pre>

    > Note: If the DHCP snooping binding table is empty, you can use the ``sudo service networking restart`` command to force all three PCs to trigger a fresh DHCP request, or use the ``sudo  udhcpc -R -i eth0`` command.
    ### Step 3
    On DSW, globally enable DHCP snooping and enable it for VLAN 10.  Configure Gi0/1 as a DHCP snooping trusted port.

    <pre>
    DSW(config)# ip dhcp snooping
    DSW(config)# ip dhcp snooping vlan 10
    DSW(config)# int g0/1
    DSW(config-if)# ip dhcp snooping trust
    </pre>

    ### Step 4
    Release and renew the DHCP IP address on PC1. Observe the result.

    <pre>
    PC1:~$ <b>sudo  udhcpc -R -i eth0</b>
    udhcpc: started, v1.37.0
    udhcpc: broadcasting discover
    udhcpc: broadcasting discover
    udhcpc: broadcasting discover
    udhcpc: broadcasting discover
    ^C
    PC1:~$
    </pre>

    Notice the syslog message that is displayed at the DSW console port:

    <pre>*Oct 20 18:07:54.063: %DHCP_SNOOPING-5-DHCP_SNOOPING_NONZERO_GIADDR: DHCP_SNOOPING drop message with non-zero giaddr or option82 value on untrusted port, message type: DHCPDISCOVER, MAC sa: 5254.0011.1111</pre>

    Because DHCP snooping is enabled on ASW, it automatically adds Option 82 information to the DHCP messages received from PC1. Option 82 was defined in RFC 3046 and serves to identify both the DHCP relay agent (if any) and the client that sent the DHCP Discover message.

    DSW automatically drops the DHCP Discover messages from PC1 with Option 82 since it arrives on a DHCP snooping untrusted port. There are two solutions to remedy this:

    * Configure ASW to not insert the Option 82 information when it receives the DHCP Discovery message from PC1, or
    * Configure DSW G0/0 to allow Option 82 information on an untrusted port.

    Since DSW is not acting as a DHCP relay agent, we will disable the insertion of Option 82 at the source on both ASW and DSW. The reason DSW needs to also be configured in this way is that it is performing DHCP snooping and will reinsert Option 82 as it forwards the DHCP Discovery message to the CML DHCP server.

    <pre>
    ASW(config)# no ip dhcp snooping information option
    DSW(config)# no ip dhcp snooping information option
    </pre>

    ## Part 4: Configure and verify Dynamic ARP Inspection
    In Part 4 you will enable DAI for VLAN 10 on ASW and ensure that the trunk link to DSW is trusted since that is the uplink that will received legitimate ARP messages. Recall that DHCP snooping is required for DAI.

    ### Step 1
    On ASW, enable DAI for VLAN 10. Configure Gi0/0 as a DAI trusted port. Adjust the rate limiting for ARP messages to 10 packets per second. Enable source MAC validation.

    <pre>
    ASW(config)# ip arp inspection vlan 10
    ASW(config)# ip arp inspection validate src-mac
    ASW(config)# int gi0/0
    ASW(config-if)# ip arp inspection trust
    ASW(config)# int range gi0/1-3
    ASW(config-if-range)# ip arp inspection limit rate 10
    </pre>

    ### Step 2
    Verify DAI.

    From the console on PC1, ping PC2 to generate some traffic and ARP requests. **The IP address for PC2 in your lab will differ from the example below.**

    <pre>
    PC1:~$ <b>ping 192.168.255.175</b>
    PING 192.168.255.175 (192.168.255.175): 56 data bytes
    64 bytes from 192.168.255.175: seq=0 ttl=42 time=8.138 ms
    64 bytes from 192.168.255.175: seq=1 ttl=42 time=2.421 ms
    PC1:~$ ^C

    PC1:~$
    </pre>

    Use the ``show ip arp inspection`` command on ASW to confirm that DAI is correctly configured.

    <pre>
    ASW#sh ip arp inspection

    <mark>Source Mac Validation      : Enabled</mark>
    Destination Mac Validation : Disabled
    IP Address Validation      : Disabled

     Vlan     Configuration    Operation   ACL Match          Static ACL
     ----     -------------    ---------   ---------          ----------
       <mark>10     Enabled          Active</mark>

     Vlan     ACL Logging      DHCP Logging      Probe Logging
     ----     -----------      ------------      -------------
       10     Deny             Deny              Off

     Vlan      Forwarded        Dropped     DHCP Drops      ACL Drops
     ----      ---------        -------     ----------      ---------
       10             <mark>10</mark>              0              0              0

     Vlan   DHCP Permits    ACL Permits  Probe Permits   Source MAC Failures
     ----   ------------    -----------  -------------   -------------------
       10              <mark>7</mark>              0              0                     0

     Vlan   Dest MAC Failures   IP Validation Failures   Invalid Protocol Data
     ----   -----------------   ----------------------   ---------------------

     Vlan   Dest MAC Failures   IP Validation Failures   Invalid Protocol Data
     ----   -----------------   ----------------------   ---------------------
       10                   0                        0                       0
    </pre>

    The output confirms that ARP messages are being inspected for VLAN 10 and that no ARP messages have been dropped. The output also tracks DHCP messages that were inspected and permitted.

    ## Part 5: Testing DHCP Snooping
    In Part 5, you will connect the rogue DHCP server to interface Gi1/0 on ASW and observe how the switch responds.

    ### Step 1
    On ASW, enable DHCP snooping debugging.

    <pre>
    ASW# <b>debug ip dhcp snooping events</b>
    </pre>

    ### Step 2
    Start the rogue DHCP server CML node by right-clicking it and selecting <b>Start</b>.

    Within a few seconds of the rogue DHCP server starting up, the ASW console should display messages indicating DAI and DHCP snooping are intercepting rogue DHCP messages:

    <pre>
    *Oct 27 14:09:29.151: %SW_DAI-4-DHCP_SNOOPING_DENY: 1 Invalid ARPs (Req) on Gi1/0, vlan 10.([5254.00e5.8f80/192.168.255.1/0000.0000.0000/192.168.255.25/14:09:28 UTC Mon Oct 27 2025])
    *Oct 27 14:09:30.151: %SW_DAI-4-DHCP_SNOOPING_DENY: 1 Invalid ARPs (Req) on Gi1/0, vlan 10.([5254.00e5.8f80/192.168.255.1/0000.0000.0000/192.168.255.25/14:09:29 UTC Mon Oct 27 2025])
    *Oct 27 14:09:31.175: %SW_DAI-4-DHCP_SNOOPING_DENY: 1 Invalid ARPs (Req) on Gi1/0, vlan 10.([5254.00e5.8f80/192.168.255.1/0000.0000.0000/192.168.255.25/14:09:30 UTC Mon Oct 27 2025])
    *Oct 27 14:09:31.405: %DHCP_SNOOPING-5-DHCP_SNOOPING_UNTRUSTED_PORT: DHCP_SNOOPING drop message on untrusted port, message type: DHCPOFFER, MAC sa: 5254.00e5.8f80
    </pre>

    Notice that the packets are getting dropped but that the interface remains in the up/up state.

    Disable all debugging with the ``no debug all`` command.

    ### Step 3
    Verify DHCP snooping and DAI activity.

    <pre>
    ASW# <b>show ip dhcp snooping statistics</b>
     Packets Forwarded                                     = 100
     Packets Dropped                                       = 41
     <mark>Packets Dropped From untrusted ports                  = 41</mark>

    ASW# <b>show ip arp inspection statistics</b>

     Vlan      Forwarded        Dropped     DHCP Drops      ACL Drops
     ----      ---------        -------     ----------      ---------
       10             32             <mark>17</mark>             <mark>17</mark>              0

     Vlan   DHCP Permits    ACL Permits  Probe Permits   Source MAC Failures
     ----   ------------    -----------  -------------   -------------------
       10             16              0              0                     0

     Vlan   Dest MAC Failures   IP Validation Failures   Invalid Protocol Data
     ----   -----------------   ----------------------   ---------------------
       10                   0                        0                       0
    </pre>

    The number of packets dropped will continue to increase as the rogue DHCP server continues to send DHCP Offer messages into the network.

    <b>Congratulations!</b> You have completed the lab. You learned how to configure and verify Layer 2 security using port security, DHCP snooping and DAI.
  title: CCNA Prep S03E01 - Layer 2 Security
  version: 0.3.0
