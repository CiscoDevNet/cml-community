id: netbox-server
boot:
  timeout: 300
  completed:
    - Welcome to Alpine Linux
  uses_regex: false
sim:
  linux_native:
    libvirt_domain_driver: kvm
    driver: server
    disk_driver: virtio
    ram: 2048
    cpus: 1
    cpu_limit: 100
    nic_driver: virtio
    boot_disk_size: 16
    video:
      memory: 16
general:
  nature: server
  description: NetBox Server Community
  read_only: false
configuration:
  generator:
    driver: alpine
  provisioning:
    files:
      - editable: true
        name: node.cfg
        content: |-
          # this is a shell script which will be sourced at boot

          # OS Level Configuration
          hostname netbox-server

          # Network Config: eth0
          # Optional: Configure static IP address if DHCP not being used
          # ip link set up dev eth0
          # ip addr add 192.168.0.11/24 dev eth0
          # ip route add default via 192.168.0.1
          # Configure DNS servers
          # echo "nameserver 192.168.0.1" > /etc/resolv.conf

          # Optional: Create an additional OS user account
          # Note: The user cisco/cisco is already created
          # USERNAME=anotheruser
          # PASSWORD=cisco

          # Network Config: eth1
          # Optional: Configure IP address on 2nd interface to
          #           allow access to the CML controller. This
          #           is required to sync the CML topology to NetBox
          #           if the primary interface doesn't have a path
          #           to the CML controller.
          # Note: The default CML firewall configuration for the
          #       NAT ext-conn does NOT allow CML API access.
          #       Either add https to the firewall rule in Cockpit
          #       or use a bridge external connector
          # ip link set up dev eth1
          # ip addr add 192.0.2.2/24 dev eth1

          # Optional: Settings to Auto Populate NetBox from CML Topology
          # By setting the following ENVs the cml2netbox/topology-2-netbox
          # script will run to attempt to populate NetBox
          # Notes:
          #   * These variables all relate to the CML controller/server
          #   * The netbox-server must be connected to an ext-conn to reach
          #     the CML API.
          #   * A bridge ext-conn will work with the default CML network config
          #   * A NAT ext-conn requires HTTPs being enabled on the virbr0 firewall
          #     zone from within Cockpit
          #   * The example value below uses the standard NAT ext-conn address.
          #     Update it for your environment if you're using a bridge ext-conn

          # export VIRL2_URL=https://192.168.255.1
          # export VIRL2_USER=admin
          # export VIRL2_PASS=1234QWer
          # export VIRL2_VERIFY_SSL=False
          # export LAB_NAME="My CML Lab"
          # Note: Lab_ID only needs to be set if multiple Labs with same
          #       Name exist on the CML server
          # export LAB_ID=****

          # These two scripts will:
          # 1. Check if NetBox is healthy
          # 2. Check if CML is reachable, and if so...
          # 3. Run the script to sync the CML topology to Netbox
          /home/cisco/check_netbox.sh >> /home/cisco/startup_log.txt 2>> /home/cisco/startup_err.txt
          /home/cisco/check_and_sync_cml.sh >> /home/cisco/startup_log.txt 2>> /home/cisco/startup_err.txt
    media_type: iso
    volume_name: cfg
device:
  interfaces:
    serial_ports: 1
    physical:
      - eth0
      - eth1
      - eth2
      - eth3
    has_loopback_zero: false
    default_count: 1
ui:
  label_prefix: netbox-server-
  icon: server
  label: NetBox
  visible: true
  group: Others
  description: |-
    NetBox Server Community (netbox-docker)

    Reachable at: **http://{{NODE_IP}}**

    Running on Alpine Linux

    2048 MB DRAM, 1 vCPU, 16GB base disk

    ### NetBox Server Details
    NetBox is running via netbox-docker and has had the following initial configuration applied:

    * NetBox Super User: `cisco / cisco`
        * RW API Token Created: `0123456789012345678901234567890123456789`
    * Device types have been created for CML Node Definitions
    * NetBox will be reachable at `http://<node-ip>`

    ### Alpine Linux Details
    ##### Configuration
    Shell commands in the configuration field of the node are just sourced as user `root`
    when the node starts up. This is based on Alpine Linux. More info [here](https://wiki.alpinelinux.org/wiki/Main_Page)

    ##### Users
    The user account is configurable (cisco/cisco by default).

    This image has a couple of tools:

    - iperf -- basic traffic generation
    - routem -- OSPF/BGP control plane traffic generation
    - tcpdump, traceroute, ping, telnet, ssh
    - runs a SSH daemon

    ##### Example
    ```shell
    hostname desktop-0
    ip address add 10.0.0.10/24 dev eth1
    ip link set dev eth1 up
    ip route add 10.0.0.0/8 dev eth1
    ip route add default via 10.0.0.1
    ```

    [Link](https://www.alpinelinux.org/)
inherited:
  image:
    ram: true
    cpus: true
    data_volume: true
    boot_disk_size: true
    cpu_limit: true
  node:
    ram: true
    cpus: true
    data_volume: true
    boot_disk_size: true
    cpu_limit: true
pyats:
  os: linux
  use_in_testbed: true
schema_version: 0.0.1
